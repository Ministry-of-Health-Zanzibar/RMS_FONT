<div *ngIf="referral" class="p-6 bg-gray-50 min-h-screen">
  <h2 class="text-4xl font-bold text-center text-primary-700 mb-10">
    Referral Details
  </h2>
  <div class="bg-white shadow-2xl rounded-3xl p-8 max-w-6xl mx-auto space-y-8">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Patient Info -->
      <div
        class="bg-indigo-50 p-6 rounded-2xl shadow-inner flex flex-col space-y-2"
      >
        <h3 class="text-2xl font-semibold text-indigo-700 mb-2">
          Patient Info
        </h3>
        <p>
          <span class="font-semibold w-32 inline-block">Name:</span>
          {{ referral.patient?.name || "N/A" }}
        </p>
         <p>
          <span class="font-semibold w-32 inline-block">Matibabu Card:</span>
          {{ referral.patient?.matibabu_card || "N/A" }}
        </p>
        <p>
          <span class="font-semibold w-32 inline-block">DOB:</span>
          {{
            referral.patient?.date_of_birth
              ? (referral.patient.date_of_birth | date)
              : "N/A"
          }}
        </p>
        <p>
          <span class="font-semibold w-32 inline-block">Phone:</span>
          {{ referral.patient?.phone || "N/A" }}
        </p>
        <p>
          <span class="font-semibold w-32 inline-block">Gender:</span>
          {{ referral.patient?.gender || "N/A" }}
        </p>
      </div>

      <!-- Hospital Info -->
      <div
        class="bg-green-50 p-6 rounded-2xl shadow-inner flex flex-col space-y-2"
      >
        <h3 class="text-2xl font-semibold text-green-700 mb-2">
          Hospital Info
        </h3>
        <p>
          <span class="font-semibold w-32 inline-block">Hospital:</span>
          {{ referral.hospital?.hospital_name || "N/A" }}
        </p>
        <p>
          <span class="font-semibold w-32 inline-block">Address:</span>
          {{ referral.hospital?.hospital_address || "N/A" }}
        </p>
        <p>
          <span class="font-semibold w-32 inline-block">Contact:</span>
          {{ referral.hospital?.contact_number || "N/A" }}
        </p>
        <p>
          <span class="font-semibold w-32 inline-block">Email:</span>
          {{ referral.hospital?.hospital_email || "N/A" }}
        </p>
      </div>
    </div>

    <!-- Referral Reason -->
    <div
      class="bg-yellow-50 p-6 rounded-2xl shadow-inner flex flex-col space-y-2"
    >
      <h3 class="text-2xl font-semibold text-yellow-700 mb-2">
        Referral Reason
      </h3>
      <p>
        <span class="font-semibold w-32 inline-block">Reason:</span>
        {{ referral.reason?.referral_reason_name || "N/A" }}
      </p>
      <p>
        <span class="font-semibold w-32 inline-block">Description:</span>
        {{ referral.reason?.reason_descriptions || "N/A" }}
      </p>
    </div>

    <!-- Status -->
    <div class="flex items-center space-x-4">
      <h3 class="text-2xl font-semibold text-gray-700">Status:</h3>
      <span
        class="inline-flex items-center px-5 py-2 text-base font-semibold rounded-full text-white shadow-md"
        [ngClass]="{
          'bg-green-500': referral.status === 'Confirmed',
          'bg-red-500': referral.status === 'Cancelled',
          'bg-yellow-500': referral.status === 'Pending',
          'bg-blue-500': referral.status === 'On-Progress'
        }"
      >
        {{ referral.status || "N/A" }}
      </span>
    </div>

    <!-- Patient Files -->
    <div
      *ngIf="referral.patient?.files?.length > 0"
      class="bg-purple-50 p-6 rounded-2xl shadow-inner flex flex-col space-y-3"
    >
      <h3 class="text-2xl font-semibold text-purple-700 mb-2">Patient Files</h3>
      <div class="flex flex-col space-y-2">
        <a
          *ngFor="let file of referral.patient.files"
          [href]="'http://127.0.0.1:8000/storage/' + file.file_path"
          target="_blank"
          class="flex items-center space-x-3 text-purple-800 hover:text-purple-600 hover:underline transition"
        >
          <mat-icon class="text-purple-700">description</mat-icon>
          <span>{{ file.file_name || "N/A" }}</span>
        </a>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="flex justify-center mt-6 space-x-6">
      <!-- Confirm Button -->
      <button
        mat-raised-button
        color="primary"
        class="bg-primary-600 hover:bg-primary-700 text-white px-10 py-3 rounded-2xl shadow-lg transition transform hover:scale-105"
        (click)="updateStatusPopup()"
        [disabled]="referral.status !== 'Pending'"
      >
        Confirm
      </button>

      <!-- Print Button -->
      <button
        mat-raised-button
        color="accent"
        class="bg-indigo-600 hover:bg-indigo-700 text-white px-10 py-3 rounded-2xl shadow-lg transition transform hover:scale-105"
        (click)="referralsLetterPopup(referral)"
        [disabled]="referral.status == 'Pending'"
      >
        <mat-icon class="mr-2">print</mat-icon>
        Print
      </button>
    </div>
  </div>
</div>
