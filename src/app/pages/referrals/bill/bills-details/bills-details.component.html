<div class="container my-5" *ngIf="billData">
  <!-- Page Title -->
  <div class="text-center mb-5">
    <h2 class="fw-bold text-gradient">
      <mat-icon color="primary">receipt</mat-icon> Bill Details
    </h2>
    <p class="text-muted">Comprehensive overview of your billing information</p>
  </div>

  <mat-accordion multi>
    <!-- Basic Info -->
    <mat-expansion-panel expanded>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon color="primary">info</mat-icon> Basic Info
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-card>
        <table
          mat-table
          [dataSource]="[
            {
              label: 'Total Amount',
              value: (billData.total_amount | currency : 'TZS ')
            },
            {
              label: 'Period',
              value:
                (billData.bill_period_start | date : 'dd/MM/yyyy') +
                ' - ' +
                (billData.bill_period_end | date : 'dd/MM/yyyy')
            },

            { label: 'Status', value: billData.bill_status }
          ]"
          class="mat-elevation-z1 full-width-table"
        >
          <ng-container matColumnDef="label">
            <th mat-header-cell *matHeaderCellDef>Field</th>
            <td mat-cell *matCellDef="let row">{{ row.label }}</td>
          </ng-container>

          <ng-container matColumnDef="value">
            <th mat-header-cell *matHeaderCellDef>Value</th>
            <td mat-cell *matCellDef="let row">
              <ng-container *ngIf="row.label === 'Status'; else normalValue">
                <span
                  class="mat-chip mat-elevation-z2"
                  [ngClass]="row.value.toLowerCase()"
                >
                  {{ row.value }}
                </span>
              </ng-container>
              <ng-template #normalValue>{{ row.value }}</ng-template>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['label', 'value']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['label', 'value']"></tr>
        </table>
      </mat-card>
    </mat-expansion-panel>

    <!-- Bill File -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon color="accent">description</mat-icon> Bill File
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-card>
        <mat-list>
          <mat-list-item>
            <strong>Title:</strong>&nbsp;
            {{ billData.bill_file?.bill_file_title }}
          </mat-list-item>
          <mat-list-item>
            <strong>Amount:</strong>&nbsp;
            {{ billData.bill_file?.bill_file_amount | currency : "TZS " }}
          </mat-list-item>
          <mat-list-item>
            <a
              mat-stroked-button
              color="accent"
              [href]="billData.bill_file?.bill_file"
              target="_blank"
            >
              <mat-icon>download</mat-icon>
              Download File
            </a>
          </mat-list-item>
        </mat-list>
      </mat-card>
    </mat-expansion-panel>

    <!-- Referral -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon color="warn">compare_arrows</mat-icon> Referral
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-card>
        <mat-list>
          <mat-list-item
            ><strong>Referral Number:</strong>&nbsp;
            {{ billData.referral?.referral_number }}</mat-list-item
          >
          <mat-list-item>
            <strong>Status:</strong>&nbsp;
            <mat-chip
              [ngClass]="{
                'chip-confirmed': billData.referral?.status === 'Confirmed',
                'chip-pending': billData.referral?.status === 'Pending',
                'chip-rejected': billData.referral?.status === 'Rejected'
              }"
            >
              {{ billData.referral?.status }}
            </mat-chip>
          </mat-list-item>

          <mat-list-item
            ><strong>Reason:</strong>&nbsp;
            {{ billData.referral?.reason?.referral_reason_name }}</mat-list-item
          >
        </mat-list>
      </mat-card>
    </mat-expansion-panel>

    <!-- Patient -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon color="primary">person</mat-icon> Patient
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-card>
        <mat-list>
          <mat-list-item
            ><strong>Name:</strong>&nbsp;
            {{ billData.referral?.patient?.name }}</mat-list-item
          >
          <mat-list-item
            ><strong>DOB:</strong>&nbsp;
            {{
              billData.referral?.patient?.date_of_birth | date : "dd/MM/yyyy"
            }}</mat-list-item
          >
          <mat-list-item
            ><strong>Gender:</strong>&nbsp;
            {{ billData.referral?.patient?.gender }}</mat-list-item
          >
          <mat-list-item
            ><strong>Phone:</strong>&nbsp;
            {{ billData.referral?.patient?.phone }}</mat-list-item
          >
          <mat-list-item
            ><strong>Location:</strong>&nbsp;
            {{
              billData.referral?.patient?.geographical_location?.location_name
            }}</mat-list-item
          >
        </mat-list>
      </mat-card>
    </mat-expansion-panel>

    <!-- Hospital -->
    <mat-expansion-panel>
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon color="accent">local_hospital</mat-icon> Hospital
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-card>
        <mat-list>
          <mat-list-item
            ><strong>Name:</strong>&nbsp;
            {{ billData.referral?.hospital?.hospital_name }}</mat-list-item
          >
          <mat-list-item
            ><strong>Code:</strong>&nbsp;
            {{ billData.referral?.hospital?.hospital_code }}</mat-list-item
          >
          <mat-list-item
            ><strong>Address:</strong>&nbsp;
            {{ billData.referral?.hospital?.hospital_address }}</mat-list-item
          >
          <mat-list-item
            ><strong>Contact:</strong>&nbsp;
            {{ billData.referral?.hospital?.contact_number }}</mat-list-item
          >
          <mat-list-item
            ><strong>Email:</strong>&nbsp;
            {{ billData.referral?.hospital?.hospital_email }}</mat-list-item
          >
        </mat-list>
      </mat-card>
    </mat-expansion-panel>
  </mat-accordion>
</div>
