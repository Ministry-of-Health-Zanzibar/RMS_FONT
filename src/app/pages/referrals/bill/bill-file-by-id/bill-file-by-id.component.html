<div *ngIf="bills && bills.length > 0" class="max-w-7xl mx-auto p-6">
  <!-- Banner Header -->
  <div
    class="relative bg-gradient-to-r from-blue-700 to-blue-500 text-white rounded-2xl shadow-lg p-10 mb-8 flex items-center justify-center overflow-hidden"
  >
    <!-- Left AI Image -->
    <img
      src="../../../../assets/img/doctor.png"
      alt="AI Left"
      class="absolute left-4 top-1/2 transform -translate-y-1/2 w-28 h-28 opacity-80 rounded-full shadow-lg"
    />

    <!-- Center Text -->
    <div class="text-center z-10">
      <h1 class="text-4xl font-bold tracking-wide drop-shadow-md">
        Bill Records
      </h1>
      <p class="mt-3 text-lg opacity-90">
        A complete list of registered patients and their details
      </p>
    </div>

    <!-- Right AI Image -->
    <img
      src="../../../../assets/img/objective3.png"
      alt="AI Right"
      class="absolute right-4 top-1/2 transform -translate-y-1/2 w-28 h-28 opacity-80 rounded-full shadow-lg"
    />
  </div>

  <!-- Bill File Info Table -->
  <div
    *ngIf="bills[0]"
    class="bg-white shadow-xl rounded-2xl overflow-hidden mb-8"
  >
    <table class="w-full table-auto border-collapse">
      <thead class="bg-gray-200 text-gray-700">
        <tr>
          <th class="border border-gray-300 p-3">Bill Title</th>
          <th class="border border-gray-300 p-3">Bill File</th>
          <th class="border border-gray-300 p-3">Amount</th>
          <th class="border border-gray-300 p-3">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <!-- Bill title centered -->
          <td
            class="border border-gray-300 p-3 font-medium text-gray-700 text-center"
          >
            {{ bills[0].bill_file_title }}
          </td>

          <!-- PDF link centered -->
          <td class="border border-gray-300 p-3 text-center">
            <a
              [href]="'http://127.0.0.1:8000/storage/' + bills[0].bill_file"
              target="_blank"
              class="inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-800 justify-center"
            >
              <mat-icon>picture_as_pdf</mat-icon>
              View PDF
            </a>
          </td>

          <!-- Amount -->
          <td class="border border-gray-300 p-3 text-center">
            {{ bills[0].bill_file_amount | currency : "TZS " }}
          </td>

          <!-- Action button centered -->
          <td class="border border-gray-300 p-3 text-center">
            <span
              (click)="addPatientToBill(bills[0].bill_file_id)"
              *ngIf="permission.parmissionMatched(['View Patient List'])"
              matTooltip="Add Bill"
              class="cursor-pointer w-10 h-10 flex items-center justify-center text-white bg-blue-600 rounded-full hover:bg-blue-700 transition-all mx-auto"
            >
              <mat-icon>add</mat-icon>
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Bills List Section -->
  <div
    *ngIf="billsList && billsList.length > 0"
    class="bg-white shadow-xl rounded-2xl overflow-hidden mb-8"
  >
    <div
      class="bg-gray-50 px-6 py-4 border-b flex justify-between items-center"
    >
      <h3 class="text-xl font-semibold text-gray-800">Created Bills</h3>
      <button
        mat-raised-button
        color="primary"
        (click)="addPatientToBill(bills[0].bill_file_id)"
      >
        <mat-icon>add</mat-icon>
        Create New Bill 
      </button>
    </div>

    <table class="w-full table-auto border-collapse">
      <thead class="bg-gray-200 text-gray-700">
        <tr>
          <th class="border border-gray-300 p-3">Bill ID</th>
          <th class="border border-gray-300 p-3">Referral ID</th>
          <th class="border border-gray-300 p-3">Total Amount</th>
          <th class="border border-gray-300 p-3">Period</th>
          <th class="border border-gray-300 p-3">Status</th>
          <th class="border border-gray-300 p-3">Created At</th>
          <th class="border border-gray-300 p-3">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let bill of billsList" class="hover:bg-gray-50">
          <td class="border border-gray-300 p-3 text-center">
            {{ bill.bill_id }}
          </td>
          <td class="border border-gray-300 p-3 text-center">
            {{ bill.referral_id }}
          </td>
          <td
            class="border border-gray-300 p-3 text-center font-medium text-green-600"
          >
            {{ bill.total_amount | currency : "TZS " }}
          </td>
          <td class="border border-gray-300 p-3 text-center">
            {{ bill.bill_period_start | date : "shortDate" }} -
            {{ bill.bill_period_end | date : "shortDate" }}
          </td>
          <td class="border border-gray-300 p-3 text-center">
            <span
              [ngClass]="{
                'bg-yellow-100 text-yellow-800': bill.bill_status === 'Pending',
                'bg-green-100 text-green-800': bill.bill_status === 'Paid',
                'bg-red-100 text-red-800': bill.bill_status === 'Rejected'
              }"
              class="px-2 py-1 rounded-full text-xs font-medium"
            >
              {{ bill.bill_status }}
            </span>
          </td>
          <td class="border border-gray-300 p-3 text-center">
            {{ bill.created_at | date : "short" }}
          </td>
          <td class="border border-gray-300 p-3 text-center">
            <button mat-icon-button color="primary" matTooltip="View Details">
              <mat-icon>visibility</mat-icon>
            </button>
            <button
              mat-icon-button
              color="warn"
              matTooltip="Delete Bill"
              (click)="deleteBill(bill.bill_id)"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty Bills State -->
  <div
    *ngIf="bills[0] && (!billsList || billsList.length === 0)"
    class="bg-white shadow-xl rounded-2xl overflow-hidden mb-8 p-6 text-center"
  >
    <mat-icon class="text-4xl text-gray-400 mb-4">receipt</mat-icon>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">
      No Bills Created Yet
    </h3>
    <p class="text-gray-500 mb-4">
      There are no bills associated with this bill file.
    </p>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center p-8">
    <div
      class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"
    ></div>
    <p class="mt-4 text-gray-600">Loading data...</p>
  </div>
</div>

<div
  *ngIf="!loading && (!bills || bills.length === 0)"
  class="max-w-7xl mx-auto p-6 text-center"
>
  <div class="bg-white rounded-2xl shadow-lg p-10">
    <mat-icon class="text-6xl text-gray-400 mb-4">description</mat-icon>
    <h2 class="text-2xl font-bold text-gray-700 mb-2">No Bill Found</h2>
    <p class="text-gray-500">
      The bill you're looking for doesn't exist or may have been removed.
    </p>
  </div>
</div>
