<div class="max-w-7xl mx-auto p-6">
  <!-- Bill File Table -->
  <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Bill File Info</h2>
      <mat-form-field appearance="fill">
        <mat-label>Filter Bill File</mat-label>
        <input
          matInput
          (keyup)="applyBillFileFilter($event)"
          placeholder="Filter..."
        />
      </mat-form-field>
    </div>

    <table
      mat-table
      [dataSource]="billFileDataSource"
      matSort
      class="min-w-full"
    >
      <ng-container matColumnDef="bill_file_title">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Bill Title</th>
        <td mat-cell *matCellDef="let file">{{ file.bill_file_title }}</td>
      </ng-container>

      <ng-container matColumnDef="bill_file">
        <th mat-header-cell *matHeaderCellDef>File</th>
        <td mat-cell *matCellDef="let file">
          <a
            [href]="'http://127.0.0.1:8000/storage/' + file.bill_file"
            target="_blank"
          >
            <mat-icon>picture_as_pdf</mat-icon> View PDF
          </a>
        </td>
      </ng-container>

      <ng-container matColumnDef="bill_file_amount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Amount</th>
        <td mat-cell *matCellDef="let file">
          {{ file.bill_file_amount | currency : "TZS " }}
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let file">
          <button mat-icon-button [matMenuTriggerFor]="billFileMenu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #billFileMenu="matMenu">
            <button mat-menu-item (click)="addPatientToBill(file.bill_file_id)">
              <mat-icon color="primary">add</mat-icon>
              <span>Add Bill</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedBillFileColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedBillFileColumns"></tr>
    </table>

    <mat-paginator
      #billFilePaginator
      [pageSizeOptions]="[5, 10]"
      showFirstLastButtons
    ></mat-paginator>
  </div>

  <!-- Bills List Table -->
  <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Bills List</h2>
      <mat-form-field appearance="fill">
        <mat-label>Filter Bills</mat-label>
        <input
          matInput
          (keyup)="applyBillFilter($event)"
          placeholder="Filter..."
        />
      </mat-form-field>
    </div>

    <table mat-table [dataSource]="billDataSource" matSort class="min-w-full">
      <ng-container matColumnDef="bill_id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Bill ID</th>
        <td mat-cell *matCellDef="let bill">{{ bill.bill_id }}</td>
      </ng-container>

      <ng-container matColumnDef="hospital_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Hospital Name</th>
        <td mat-cell *matCellDef="let bill">{{ bill.hospital_name }}</td>
      </ng-container>

      <ng-container matColumnDef="referral_number">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Referral number
        </th>
        <td mat-cell *matCellDef="let bill">{{ bill.referral_number }}</td>
      </ng-container>

      <ng-container matColumnDef="patient_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Patient name</th>
        <td mat-cell *matCellDef="let bill">{{ bill.patient_name }}</td>
      </ng-container>

      <ng-container matColumnDef="total_amount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Amount</th>
        <td mat-cell *matCellDef="let bill">
          {{ bill.total_amount | currency : "TZS " }}
        </td>
      </ng-container>

      <ng-container matColumnDef="bill_period">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Period</th>
        <td mat-cell *matCellDef="let bill">
          {{ bill.bill_period_start | date : "shortDate" }} -
          {{ bill.bill_period_end | date : "shortDate" }}
        </td>
      </ng-container>

      <ng-container matColumnDef="bill_status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let bill">
          <span
            [ngClass]="{
              'bg-yellow-100 text-yellow-800': bill.bill_status === 'Pending',
              'bg-green-100 text-green-800': bill.bill_status === 'Paid',
              'bg-red-100 text-red-800': bill.bill_status === 'Rejected'
            }"
            class="px-2 py-1 rounded-full text-xs font-medium"
            >{{ bill.bill_status }}</span
          >
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let bill">
          <button mat-icon-button [matMenuTriggerFor]="billMenu">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #billMenu="matMenu">
            <button mat-menu-item (click)="displayBillDetails(bill)">
              <mat-icon>visibility</mat-icon>
              <span>View</span>
            </button>
            <button mat-menu-item (click)="deleteBill(bill.bill_id)">
              <mat-icon color="warn">delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedBillColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedBillColumns"></tr>
    </table>

    <mat-paginator
      #billPaginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</div>
