<div class="max-w-7xl mx-auto p-6">
  <!-- Bill File Table -->
<div *ngIf="billFileDataSource" class="bg-white shadow-xl rounded-2xl overflow-hidden p-6 mb-6">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold">Bill File Info</h2>
    <!-- <mat-form-field appearance="fill">
      <mat-label>Filter Bill File</mat-label>
      <input
        matInput
        (keyup)="applyBillFileFilter($event)"
        placeholder="Filter..."
      />
    </mat-form-field> -->
  </div>

  <table class="w-full table-auto border-collapse">
    <thead class="bg-gray-200 text-gray-700">
      <tr>
        <!-- <th class="border border-gray-300 p-3 text-center">Bill Title</th> -->
        <th class="border border-gray-300 p-3 text-center">File</th>
        <th class="border border-gray-300 p-3 text-center">Amount</th>
        <th class="border border-gray-300 p-3 text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let file of billFileDataSource.filteredData">
        <!-- Bill Title -->
        <!-- <td class="border border-gray-300 p-3 text-center font-medium text-gray-700">


        </td> -->

        <!-- PDF Link -->
        <td class="border border-gray-300 p-3 text-center">
          <a
            [href]="'http://127.0.0.1:8000/storage/' + file.bill_file"
            target="_blank"
            class="inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-800 justify-center"
          >
            <mat-icon>picture_as_pdf</mat-icon> View PDF
          </a>
        </td>

        <!-- Amount -->
        <td class="border border-gray-300 p-3 text-center">
          {{ file.bill_file_amount | currency : "TZS " }}
        </td>

        <!-- Action Button -->
        <td class="border border-gray-300 p-3 text-center">
          <span
            (click)="addPatientToBill(file.bill_file_id)"
            *ngIf="permission.parmissionMatched(['View Patient List'])"
            matTooltip="Add Bill"
            class="cursor-pointer w-10 h-10 flex items-center justify-center text-white bg-blue-600 rounded-full hover:bg-blue-700 transition-all mx-auto"
          >
            <mat-icon>person_add</mat-icon>
          </span>
        </td>
      </tr>

      <!-- No Data Row -->
      <tr *ngIf="billFileDataSource.filteredData.length === 0">
        <td colspan="4" class="border border-gray-300 p-3 text-center text-gray-500">
          No Bill Files Available
        </td>
      </tr>
    </tbody>
  </table>
</div>

  <!-- Bills List Table -->
  <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Bills List</h2>
      <mat-form-field appearance="fill">
        <mat-label>Filter Bills</mat-label>
        <input
          matInput
          (keyup)="applyBillFilter($event)"
          placeholder="Filter..."
        />
      </mat-form-field>
    </div>

    <table mat-table [dataSource]="billDataSource" matSort class="min-w-full">
      <ng-container matColumnDef="bill_id">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Bill ID</th>
        <td mat-cell *matCellDef="let bill">{{ bill.bill_id }}</td>
      </ng-container>

      <ng-container matColumnDef="hospital_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Hospital Name</th>
        <td mat-cell *matCellDef="let bill">{{ bill.hospital_name }}</td>
      </ng-container>

      <ng-container matColumnDef="referral_number">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          Referral number
        </th>
        <td mat-cell *matCellDef="let bill">{{ bill.referral_number }}</td>
      </ng-container>

      <ng-container matColumnDef="patient_name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Patient name</th>
        <td mat-cell *matCellDef="let bill">{{ bill.patient_name }}</td>
      </ng-container>

      <ng-container matColumnDef="total_amount">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Amount</th>
        <td mat-cell *matCellDef="let bill">
          {{ bill.total_amount | currency : "TZS " }}
        </td>
      </ng-container>

      <ng-container matColumnDef="bill_period">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Period</th>
        <td mat-cell *matCellDef="let bill">
          {{ bill.bill_period_start | date : "shortDate" }} -
          {{ bill.bill_period_end | date : "shortDate" }}
        </td>
      </ng-container>

      <ng-container matColumnDef="bill_status">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
        <td mat-cell *matCellDef="let bill">
          <span
            [ngClass]="{
              'bg-yellow-100 text-yellow-800': bill.bill_status === 'Pending',
              'bg-green-100 text-green-800': bill.bill_status === 'Paid',
              'bg-red-100 text-red-800': bill.bill_status === 'Rejected'
            }"
            class="px-2 py-1 rounded-full text-xs font-medium"
            >{{ bill.bill_status }}</span
          >
        </td>
      </ng-container>
<ng-container matColumnDef="actions">
  <th mat-header-cell *matHeaderCellDef>Actions</th>
  <td mat-cell *matCellDef="let bill">
    <button mat-icon-button [matMenuTriggerFor]="billMenu">
      <mat-icon>more_vert</mat-icon>
    </button>

    <mat-menu #billMenu="matMenu">
      <!-- View Bill Details -->
      <button mat-menu-item (click)="displayBillDetails(bill)">
        <mat-icon>visibility</mat-icon>
        <span>Bill details</span>
      </button>

      <!-- Edit Bill -->
      <button mat-menu-item (click)="updateBill(bill)">
        <mat-icon>edit_square</mat-icon>
        <span>Edit Bill</span>
      </button>

      <!-- View Bill Items -->
      <button mat-menu-item (click)="billFileIterm(bill)">
        <mat-icon>list_alt</mat-icon>
        <span>Bill items</span>
      </button>

      <!-- Delete Bill -->
      <button mat-menu-item (click)="deleteBill(bill.bill_id)">
        <mat-icon color="warn">delete</mat-icon>
        <span>Delete</span>
      </button>
    </mat-menu>
  </td>
</ng-container>


      <tr mat-header-row *matHeaderRowDef="displayedBillColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedBillColumns"></tr>
    </table>

    <mat-paginator
      #billPaginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</div>
