<div  class="p-4 md:p-10 space-y-6 md:space-y-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <h1 class="text-lg font-bold">Referrals </h1>
  </div>
  <div class="w-full">
    <div class="relative h-full rounded-lg border group dark:border-inverse p-4">
      <div class="font-semibold pb-2.5 border-b-2 border-b-secondary-400">
        View Referrals
      </div>
      <div class="mt-4 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="flex items-center gap-1.5">
          <div
            class="size-9 rounded-full border bg-surface flex flex items-center justify-center"
            (click)="renew()"
            matTooltip="Refresh"
          >
            <mat-icon class="font-icon visibilityData">refresh</mat-icon>
          </div>
          <emr-v-divider></emr-v-divider>
          <input
            type="text"
            placeholder="Search..."
            class="border-b h-10 w-full md:w-96 text-sm bg-transparent dark:border-b-inverse outline-0 focus-within:border-neutral-950"
            matInput
            (keyup)="applyFilter($event)"
            #input
          />
        </div>
        <!-- <div class="flex space-x-2">
          <button
            mat-flat-button
            (click)="addReferrals()"
            *ngIf="permission.parmissionMatched(['Create Referral'])"
          >
            <mat-icon class="font-icon">add</mat-icon>Add Referrals
          </button>
        </div> -->
      </div>

      <div class="border dark:border-inverse rounded-lg overflow-x-auto mt-4">
       <table mat-table [dataSource]="dataSource" class="not-prose min-w-[1000px] md:min-w-full">
          <!-- Position Column -->
          <ng-container matColumnDef="id">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
              No.
            </th>
            <td mat-cell *matCellDef="let element; let i = index">
              {{ i + 1 }}
            </td>
          </ng-container>

          <ng-container matColumnDef="referral_number">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
               Referral Number
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.referral_number || 'N/A' | uppercase }}
            </td>
          </ng-container>

            <ng-container matColumnDef="matibabu_card">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
               Matibabu Card
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.patient?.matibabu_card || 'N/A' | uppercase }}
            </td>
          </ng-container>

          <!-- Patient Name -->
          <ng-container matColumnDef="patient_name">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
              Patient Full-Name
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.patient?.name || 'N/A' | uppercase }}
            </td>
          </ng-container>

          <!-- Reason -->
          <ng-container matColumnDef="referral_reason_name">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
              Reason
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.reason?.referral_reason_name || 'N/A' }}
            </td>
          </ng-container>

          <!-- Hospital -->
          <!-- <ng-container matColumnDef="hospital_name">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
              Hospital name
            </th>
            <td mat-cell *matCellDef="let element">
              {{ element.hospital?.hospital_name || 'N/A' }}
            </td>
          </ng-container> -->

          <!-- Status -->
          <ng-container matColumnDef="status">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
              Status
            </th>
            <td
              mat-cell
              *matCellDef="let element"
              [ngClass]="{
                'text-green-600': element.status === 'Confirmed',
                'text-red-600': element.status === 'Denied',
                'text-yellow-600': element.status === 'Pending'
              }"
            >
              {{ element.status }}
            </td>
          </ng-container>

          <!-- Action -->
          <ng-container matColumnDef="action">
            <th
              mat-header-cell
              *matHeaderCellDef
              class="text-neutral-500 dark:text-neutral-400"
            >
              Action
            </th>
            <td mat-cell *matCellDef="let element">
              <emr-segmented theme="simple" class="-mx-2">
                <emr-segmented-button *ngIf="!isStaff" value="visibilityData">
                  <span
                    class="size-9 rounded-full border bg-surface flex items-center justify-center"
                    (click)="displayMoreData(element)"
                    matTooltip="View"
                  >
                    <mat-icon class="font-icon visibilityData"
                      >visibility</mat-icon
                    >
                  </span>
                </emr-segmented-button>

                  <emr-segmented-button *ngIf="isAdmin" value="visibilityData">
                  <span
                    class="size-9 rounded-full border bg-surface flex items-center justify-center"
                    (click)="displayReport(element)"
                    matTooltip="View More"
                  >
                    <mat-icon class="font-icon visibilityData"
                      >more data</mat-icon
                    >
                  </span>
                </emr-segmented-button>

                <emr-segmented-button value="edit_squareData">
                  <!-- <span class="size-9 rounded-full border bg-surface flex items-center justify-center" (click)="editReferral(element)" *ngIf="permission.parmissionMatched(['Update Patient List'])" matTooltip="Edit">
                    <mat-icon class="font-icon edit_squareData">edit_square</mat-icon>
                  </span> -->


                  <span *ngIf="element.status !== 'Pending'"
                    class="size-9 rounded-full border bg-surface flex items-center justify-center cursor-pointer"
                    (click)="viewfollowup(element)"
                    matTooltip="View Follow-Up"
                  >
                     <mat-icon class="font-icon">event_note</mat-icon>
                  </span>
                </emr-segmented-button>

                <emr-segmented-button *ngIf="isStaff" value="edit_squareData">
                  <span
                    class="size-9 rounded-full border bg-surface flex items-center justify-center"
                    (click)="updateRefererral(element.referral_id)"
                    *ngIf="
                      permission.parmissionMatched(['Update Referral'])
                    "
                    matTooltip="Edit"
                  >
                    <mat-icon class="font-icon edit_squareData"
                      >edit_square</mat-icon
                    >
                  </span>
                </emr-segmented-button>

                <emr-segmented-button *ngIf="isStaff" value="edit_squareData">
                  <mat-slide-toggle
                    [checked]="!element.deleted_at"
                    (toggleChange)="confirmBlock(element)"
                    color="primary"
                  >
                  </mat-slide-toggle>
                </emr-segmented-button>
              </emr-segmented>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell tablefoter" colspan="10">
              No data matching the filter "{{ input.value }}"
            </td>
          </tr>
        </table>

        <mat-paginator
          [pageSizeOptions]="[10, 20]"
          showFirstLastButtons
          aria-label="Select page of referrals"
          class="pt-3"
        >
        </mat-paginator>
      </div>
    </div>
  </div>

  <div
    *ngIf="loading"
    class="fixed inset-0 flex items-center justify-center bg-white bg-opacity-70 z-50"
  >
    <div
      class="w-16 h-16 border-4 border-blue-500 border-dashed rounded-full animate-spin"
    ></div>
  </div>
</div>

