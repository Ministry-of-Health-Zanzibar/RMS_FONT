<div class="p-6 max-w-6xl mx-auto">
  <mat-card class="shadow-lg rounded-2xl">
    <mat-card-header>
      <mat-card-title class="text-2xl font-bold text-gray-800">Add New Patient</mat-card-title>
      <mat-card-subtitle class="text-gray-600">Please fill in all required details</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form
        [formGroup]="patientForm"
        (ngSubmit)="onSubmit()"
        class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6"
      >
        <!-- Name -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Full Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter full name" />
          <mat-error *ngIf="patientForm.get('name')?.hasError('required')">
            Name is required
          </mat-error>
        </mat-form-field>

        <!-- Phone -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Phone</mat-label>
          <input
            matInput
            type="tel"
            formControlName="phone"
            maxlength="10"
            placeholder="Enter 10-digit phone number"
          />
          <mat-error *ngIf="patientForm.get('phone')?.hasError('required')">
            Phone number is required
          </mat-error>
          <mat-error *ngIf="patientForm.get('phone')?.hasError('pattern')">
            Phone number must be exactly 10 digits
          </mat-error>
        </mat-form-field>

        <!-- Gender -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Gender</mat-label>
          <mat-select formControlName="gender">
            <mat-option value="male">Male</mat-option>
            <mat-option value="female">Female</mat-option>
          </mat-select>
          <mat-error *ngIf="patientForm.get('gender')?.hasError('required')">
            Gender is required
          </mat-error>
        </mat-form-field>

<mat-radio-group formControlName="dob_type">
  <mat-radio-button value="known">Known Date</mat-radio-button>
  <mat-radio-button value="unknown">Estimated Age</mat-radio-button>
</mat-radio-group>

<div *ngIf="patientForm.get('dob_type')?.value === 'known'">
  <mat-form-field appearance="outline">
    <mat-label>Date of Birth</mat-label>
    <input matInput [matDatepicker]="dobPicker" formControlName="date_of_birth" />
    <mat-datepicker-toggle matSuffix [for]="dobPicker"></mat-datepicker-toggle>
    <mat-datepicker #dobPicker></mat-datepicker>
  </mat-form-field>
</div>

<div *ngIf="patientForm.get('dob_type')?.value === 'unknown'">
  <mat-form-field appearance="outline">
    <mat-label>Estimated Age</mat-label>
    <input matInput type="number" formControlName="date_of_birth" placeholder="Enter Age" />
  </mat-form-field>
</div>



        <!-- Job -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Job</mat-label>
          <input matInput formControlName="job" placeholder="Enter job" />
        </mat-form-field>

        <!-- Position -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Position</mat-label>
          <input matInput formControlName="position" placeholder="Enter position" />
        </mat-form-field>

        <!-- Location -->
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Location</mat-label>
          <input
            matInput
            placeholder="Search location"
            formControlName="location_id"
            [matAutocomplete]="auto"
          />
          <mat-autocomplete
            #auto="matAutocomplete"
            [displayWith]="displayFn"
            [panelWidth]="'auto'"
          >
            <mat-option
              *ngFor="let option of filteredOptions | async; trackBy: trackById"
              [value]="option"
            >
              {{ option.label }}
            </mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="patientForm.get('location_id')?.hasError('required')">
            Location is required
          </mat-error>
        </mat-form-field>

        <!-- Matibabu Card -->
        <mat-form-field  class="w-full">
          <mat-label>Matibabu Card</mat-label>
          <input
            matInput
            formControlName="matibabu_card"
            maxlength="12"
            placeholder="Enter 12-digit Matibabu Card Number"
          />
          <mat-error *ngIf="patientForm.get('matibabu_card')?.hasError('pattern')">
            Matibabu Card must be exactly 12 digits
          </mat-error>
        </mat-form-field>

        <!-- Patient File Upload -->
        <div class="w-full md:col-span-3">
          <label class="block text-sm font-medium text-gray-700 mb-2">Patient File</label>
          <input
            type="file"
            (change)="onFileSelected($event)"
            accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xlsx"
            class="border rounded-lg p-2 w-full"
          />
          <mat-error *ngIf="!selectedFile">File is required</mat-error>
        </div>

        <!-- Hidden patient_list_id -->
        <input type="hidden" formControlName="patient_list_id" />

        <!-- Actions -->
        <div class="flex justify-end space-x-3 md:col-span-3 pt-6">
          <button mat-stroked-button color="warn" type="button" (click)="onCancel()">Cancel</button>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="!patientForm.valid || loading"
          >
            <span *ngIf="loading" class="flex items-center">
              <mat-spinner diameter="20" class="mr-2"></mat-spinner> Processing...
            </span>
            <span *ngIf="!loading">Save Patient</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>
