<div class="p-6 bg-white rounded-lg shadow-md w-[800px] mx-auto">
  <h2 class="text-lg font-semibold mb-6 text-center">Add Medical Board Information</h2>

  <form [formGroup]="medicalForm" (ngSubmit)="onSubmit()" class="space-y-4">
    <!-- <p class="text-xs text-gray-500">
      Patient History ID: {{ medicalForm.get('patient_histories_id')?.value }}
    </p> -->

    <!-- Second Row -->



      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Reason</mat-label>
        <mat-select formControlName="board_reason_id">
          <mat-option
            *ngFor="let reason of reasonList"
            [value]="reason.reason_id"
          >
            {{ reason.referral_reason_name }}
          </mat-option>
        </mat-select>
      </mat-form-field>


    <!-- Board Comments -->
    <div class="grid grid-cols-1">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Board Comments</mat-label>
        <textarea matInput rows="3" formControlName="board_comments"></textarea>
      </mat-form-field>
    </div>

    <!-- Diagnoses Section -->
    <div>
    <mat-form-field appearance="outline" class="w-full">
  <mat-label>Select Diagnoses</mat-label>

  <mat-select
    formControlName="board_diagnosis_ids"
    multiple
    [disabled]="loadingDiagnoses"
    (openedChange)="onDiagnosesDropdownOpened()"
  >
    <!-- ðŸ”µ Loader -->
    <mat-option *ngIf="loadingDiagnoses" disabled>
      <div class="flex items-center gap-2">
        <mat-spinner diameter="18"></mat-spinner>
        <span>Loading diagnosesâ€¦</span>
      </div>
    </mat-option>

    <!-- ðŸ” Search (disabled option to avoid empty select) -->
    <mat-option *ngIf="!loadingDiagnoses" disabled>
      <input
        matInput
        placeholder="Search diagnoses..."
        [(ngModel)]="diagnosisSearch"
        (ngModelChange)="filterDiagnoses()"
        (click)="$event.stopPropagation()"
        (keydown)="$event.stopPropagation()"
        class="w-full px-2 py-1 border border-gray-300 rounded"
      />
    </mat-option>

    <!-- âœ… Diagnoses list -->
    <mat-option
      *ngFor="let d of filteredDiagnoses"
      [value]="d.diagnosis_id"
    >
      {{ d.diagnosis_name }}
    </mat-option>
  </mat-select>
</mat-form-field>

    </div>



    <!-- Buttons -->
    <div class="flex justify-end items-center gap-3 pt-4">
      <!-- Cancel Button -->
      <button
        mat-stroked-button
        type="button"
        color="warn"
        (click)="onCancel()"
        [disabled]="loading"
      >
        Cancel
      </button>

      <!-- Save Button / Spinner -->
      <button
        *ngIf="!loading"
        mat-raised-button
        color="primary"
        (click)="onSubmit()"
        [disabled]="medicalForm.invalid"
      >
        Save
      </button>

      <mat-progress-spinner
        *ngIf="loading"
        diameter="26"
        mode="indeterminate"
      ></mat-progress-spinner>
    </div>
  </form>
</div>
