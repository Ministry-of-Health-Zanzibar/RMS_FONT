<div class="max-w-lg mx-auto my-4 rounded-xl p-4 space-y-6 bg-white shadow-lg">
  <div *ngIf="bill" class="space-y-6">
    <!-- Patient Info -->
    <div class="p-4 bg-gray-50 rounded-lg shadow-sm space-y-2">
      <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
        <mat-icon color="primary">medical_services</mat-icon>
        Patient Information
      </h3>
      <ul class="text-gray-700 text-sm space-y-1">
        <li><strong>Name:</strong> {{ bill.patient.name }}</li>
        <li><strong>DOB:</strong> {{ bill.patient.date_of_birth }}</li>
        <li><strong>Gender:</strong> {{ bill.patient.gender }}</li>
        <li><strong>Phone:</strong> {{ bill.patient.phone }}</li>
        <li><strong>Location:</strong> {{ bill.patient.location }}</li>
        <li><strong>Job:</strong> {{ bill.patient.job }}</li>
        <li><strong>Position:</strong> {{ bill.patient.position }}</li>
      </ul>
    </div>

    <!-- Bill Info -->
    <div class="p-4 bg-gray-50 rounded-lg shadow-sm">
      <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
        <mat-icon color="accent">receipt_long</mat-icon>
        Bill Details
      </h3>
      <div
        class="text-2xl font-extrabold text-gray-900 mt-2 flex items-center gap-1"
      >
        <mat-icon class="text-green-600">monetization_on</mat-icon>
        {{ bill.bill_amount | currency : "TZS" }}
      </div>
    </div>

    <!-- Payments -->
    <div
      *ngIf="bill.payments?.length"
      class="p-4 bg-gray-50 rounded-lg shadow-sm space-y-2"
    >
      <h3 class="text-lg font-bold text-gray-800 flex items-center gap-2">
        <mat-icon color="warn">payment</mat-icon>
        Payments Made
      </h3>
      <ul class="text-gray-700 text-sm space-y-1">
        <li *ngFor="let p of bill.payments" class="flex justify-between">
          <span
            >{{ p.payment_date | date : "mediumDate" }} ({{
              p.payment_method
            }})</span
          >
          <span class="font-medium">{{
            p.amount_paid | currency : "TZS"
          }}</span>
        </li>
        <li class="flex justify-between font-bold border-t pt-2 mt-2">
          <span>Total Payments</span>
          <span>{{ totalPayments | currency : "TZS" }}</span>
        </li>
        <li class="flex justify-between font-bold">
          <span>Remaining Bill</span>
          <span
            [ngClass]="{
              'text-green-600': difference <= 0,
              'text-red-600': difference > 0
            }"
          >
            {{ difference | currency : "TZS" }}
          </span>
        </li>
      </ul>
    </div>

    <!-- Add Payment Form -->
    <div class="p-4 border rounded-lg bg-gray-50 shadow-sm">
      <h3 class="text-lg font-semibold mb-4">Add Payment</h3>
      <form
        [formGroup]="paymentForm"
        (ngSubmit)="addPayment()"
        class="space-y-4"
      >
        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Payer</mat-label>
          <input matInput formControlName="payer" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Amount</mat-label>
          <input matInput type="number" formControlName="amount_paid" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Currency</mat-label>
          <mat-select formControlName="currency">
            <mat-option value="TZS">TZS</mat-option>
            <mat-option value="USD">USD</mat-option>
            <mat-option value="EUR">EUR</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Payment Method</mat-label>
          <mat-select formControlName="payment_method">
            <mat-option value="Cash">Cash</mat-option>
            <mat-option value="Bank Transfer">Bank Transfer</mat-option>
            <mat-option value="Mobile Money">Mobile Money</mat-option>
            <mat-option value="Card">Card</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Reference Number</mat-label>
          <input matInput formControlName="reference_number" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Voucher Number</mat-label>
          <input matInput formControlName="voucher_number" />
        </mat-form-field>

        <mat-form-field appearance="outline" class="w-full">
          <mat-label>Payment Date</mat-label>
          <input
            matInput
            [matDatepicker]="picker"
            formControlName="payment_date"
          />
          <mat-datepicker-toggle
            matSuffix
            [for]="picker"
          ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <button mat-raised-button color="primary" class="w-full" type="submit">
          <mat-icon>add</mat-icon> Add Payment
        </button>
      </form>
    </div>
  </div>
</div>
