<div class="p-10 space-y-8">

  <!-- Body List Table -->
  <div
    *ngIf="bodyListDataSource"
    class="bg-white shadow-xl rounded-2xl overflow-hidden p-6 mb-6"
  >
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Medical Board Informations</h2>
    </div>

    <table class="w-full table-auto border-collapse">
      <thead class="bg-gray-200 text-gray-700">
        <tr>
          <th class="border border-gray-300 p-3 text-center">Board Title</th>
          <th class="border border-gray-300 p-3 text-center">Board Type</th>
          <th class="border border-gray-300 p-3 text-center">No of Patients</th>
          <th class="border border-gray-300 p-3 text-center">File</th>
          <th class="border border-gray-300 p-3 text-center">Add Multiple</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let file of bodyListDataSource.filteredData">

          <td class="border border-gray-300 p-3 text-center font-medium text-gray-700">
            {{ file.patient_list_title }}
          </td>

          <td class="border border-gray-300 p-3 text-center font-medium text-gray-700">
            {{ file.board_type }}
          </td>

          <td class="border border-gray-300 p-3 text-center font-medium text-gray-700">
            {{ file.no_of_patients }}
          </td>

          <td class="border border-gray-300 p-3 text-center">
            <a
              *ngIf="file?.patient_list_file"
              (click)="viewPDF(file)"
              class="inline-flex items-center gap-1 text-indigo-600 hover:text-indigo-800 cursor-pointer"
            >
              <mat-icon>picture_as_pdf</mat-icon> View PDF
            </a>
          </td>

          <td class="border border-gray-300 p-3 text-center">
            <span
              (click)="addMultiple(file.patient_list_id)"
              *ngIf="permission.parmissionMatched(['View Patient List'])"
              matTooltip="Add Multiple Patients"
              class="cursor-pointer w-10 h-10 flex items-center justify-center text-white bg-blue-600 rounded-full hover:bg-blue-700 transition-all mx-auto"
            >
              <mat-icon>group_add</mat-icon>
            </span>
          </td>

        </tr>

        <tr *ngIf="bodyListDataSource.filteredData.length === 0">
          <td colspan="4" class="border border-gray-300 p-3 text-center text-gray-500">
            No Body List Available
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Patients Table -->
  <div class="bg-white shadow-xl rounded-2xl p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Patients List</h2>

      <mat-form-field appearance="fill">
        <mat-label>Filter Patients</mat-label>
        <input
          matInput
          (keyup)="applyPatientFilter($event)"
          placeholder="Filter..."
        />
      </mat-form-field>
    </div>

    <table mat-table [dataSource]="patientDataSource" matSort class="min-w-full">

      <!-- Matibabu Card -->
      <ng-container matColumnDef="matibabu_card">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Matibabu Card</th>
        <td mat-cell *matCellDef="let p" class="text-blue-600 font-medium">
          {{ p.matibabu_card ?? 'N/A' }}
        </td>
      </ng-container>

      <!-- Patient Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Patient Name</th>
        <td mat-cell *matCellDef="let p">{{ p.name | uppercase }}</td>
      </ng-container>

      <!-- Gender -->
      <ng-container matColumnDef="gender">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Gender</th>
        <td mat-cell *matCellDef="let p">{{ p.gender | uppercase }}</td>
      </ng-container>

      <!-- Phone -->
      <ng-container matColumnDef="phone">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Phone</th>
        <td mat-cell *matCellDef="let p">{{ p.phone }}</td>
      </ng-container>

      <!-- Location -->
      <ng-container matColumnDef="location">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Location</th>
        <td mat-cell *matCellDef="let p">{{ p.location }}</td>
      </ng-container>

      <!-- Status -->
  <ng-container matColumnDef="latest_history">
  <th mat-header-cell *matHeaderCellDef>Status</th>
  <td mat-cell *matCellDef="let p">
    <span
      class="px-3 py-1 rounded-full text-white"
      [ngClass]="{
        'bg-gray-400': !p.latest_history?.status,   
        'bg-green-600': p.latest_history?.status === 'pending',
        'bg-yellow-500': p.latest_history?.status === 'reviewed',
        'bg-red-600': p.latest_history?.status === 'requested',
        'bg-blue-600': p.latest_history?.status === 'approved',
        'bg-indigo-600': p.latest_history?.status === 'confirmed',
        'bg-red-800': p.latest_history?.status === 'rejected'
      }"
    >
      {{ p.latest_history?.status?.toUpperCase() || 'N/A' }}
    </span>
  </td>
</ng-container>




      <!-- Medical History Button -->
   <ng-container matColumnDef="files">
  <th mat-header-cell *matHeaderCellDef>Actions</th>
  <td mat-cell *matCellDef="let p">
    <button
      mat-icon-button
      color="primary"
      (click)="openAddMedicalHistory(p)"
      matTooltip="Add Medical History"
      class="!bg-blue-600 hover:!bg-blue-700 text-white rounded-full transition-all"
      [disabled]="p.latest_history?.status?.toLowerCase() !== 'reviewed'"
    >
      <mat-icon>note_add</mat-icon>
    </button>
  </td>
</ng-container>



      <!-- Render Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedPatientColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedPatientColumns"></tr>
    </table>

    <mat-paginator
      #patientPaginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</div>
